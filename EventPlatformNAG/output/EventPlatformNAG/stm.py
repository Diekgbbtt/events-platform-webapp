# Copyright (c) 2025 All Rights Reserved
# Generated code

from security_model import SecurityModel
from model import Action, Constraint
from enum import auto, Enum
import dtm

class FullAccess(SecurityModel):
    @classmethod
    def permit(cls, r, attr, act, self, caller, value=None):
        def __securitycheck__():
            return True
        return __securitycheck__()


# Security model

class EventPlatformNAGSecurityModel(SecurityModel):
    class Role(Enum):
        VISITOR = auto()
        REGULARUSER = auto()
        PREMIUMUSER = auto()
        MODERATOR = auto()
        ADMIN = auto()
        
        def isSubRole(self, obj):
            return (False)

        def __le__ (self,obj):
            if isinstance(obj,EventPlatformNAGSecurityModel.Role):
                if SecurityModel.closure == {}:
                    SecurityModel.close(EventPlatformNAGSecurityModel.Role)
                return self in SecurityModel.closure and obj in SecurityModel.closure[self]
            else:
                raise ValueError
    
    model = {Role.VISITOR: {'Person': {'name': {Action.read: Constraint.fullAccess}, 'surname': {Action.read: Constraint.fullAccess}, 'role': {Action.read: Constraint.fullAccess}, 'moderates': {Action.read: Constraint.fullAccess}, 'logs': {Action.add: lambda self=None, caller=None, value=None: value.dot('user') == None}}, 'Event': {'title': {Action.read: Constraint.fullAccess}, 'description': {Action.read: Constraint.fullAccess}, 'owner': {Action.read: Constraint.fullAccess}, 'categories': {Action.read: Constraint.fullAccess}, 'logs': {Action.add: lambda self=None, caller=None, value=None: value.dot('user') == None}}, 'Category': {'name': {Action.read: Constraint.fullAccess}, 'events': {Action.read: Constraint.fullAccess}, 'moderators': {Action.read: Constraint.fullAccess}}, 'Ad': {'content': {Action.read: Constraint.fullAccess}}, 'Log': {'Log': {Action.create: Constraint.fullAccess}, 'user': {Action.update: lambda self=None, caller=None, value=None: self.dot('user') == None}, 'event': {Action.update: Constraint.fullAccess}, 'timestamp': {Action.update: lambda self=None, caller=None, value=None: dtm.Log.allInstances().isEmpty() or dtm.Log.allInstances().asSequence().last().dot('timestamp') < value}}}, Role.REGULARUSER: {'Person': {'gender': {Action.read: lambda self= None, caller= None: self == caller, Action.update: lambda caller=None, self=None, value=None: self == caller}, 'email': {Action.read: lambda self= None, caller= None: self == caller, Action.update: lambda caller=None, self=None, value=None: self == caller}, 'events': {Action.read: lambda self= None, caller= None: self == caller, Action.add: lambda self=None, caller=None, value=None: value.dot('owner') == None, Action.remove: lambda self=None, caller=None, value=None: value.dot('owner') == None}, 'manages': {Action.read: lambda self= None, caller= None: self == caller, Action.add: lambda value= None, caller= None, self= None: value.dot('owner') == caller and ((not value.dot('attendants').isEmpty() and value.dot('attendants').includes(self)) or value.dot('owner') == self), Action.remove: lambda value= None, self= None, caller= None: value.dot('owner') != self and value.dot('owner') == caller}, 'attends': {Action.read: lambda self= None, caller= None: self == caller, Action.add: lambda value= None, caller= None, self= None: ((not value.dot('managedBy').isEmpty() and value.dot('managedBy').includes(caller)) or value.dot('owner') == caller) and (not value.dot('requesters').isEmpty() and value.dot('requesters').includes(self)), Action.remove: lambda value= None, self= None, caller= None: (value.dot('owner') != self and (value.dot('managedBy').isEmpty() or not value.dot('managedBy').includes(self))) and ((not value.dot('managedBy').isEmpty() and value.dot('managedBy').includes(caller)) or value.dot('owner') == caller or self == caller)}, 'subscriptions': {Action.read: lambda self= None, caller= None: self == caller, Action.add: lambda caller=None, self=None, value=None: self == caller, Action.remove: lambda caller=None, self=None, value=None: self == caller}, 'requests': {Action.read: lambda self= None, caller= None: self == caller, Action.add: lambda caller=None, self=None, value=None: self == caller, Action.remove: lambda value= None, caller= None, self= None: (not value.dot('managedBy').isEmpty() and value.dot('managedBy').includes(caller)) or value.dot('owner') == caller or self == caller}, 'logs': {Action.read: lambda self= None, caller= None: self == caller, Action.add: lambda caller=None, self=None, value=None: self == caller}, 'name': {Action.update: lambda caller=None, self=None, value=None: self == caller}, 'surname': {Action.update: lambda caller=None, self=None, value=None: self == caller}}, 'Event': {'Event': {Action.create: lambda caller= None: dtm.Event.allInstances().select((lambda e: e.dot('owner') == caller)).size() < 5, Action.delete: lambda self= None, caller= None: self.dot('owner') == caller}, 'requesters': {Action.read: lambda self= None, caller= None: self.dot('owner') == caller or (not self.dot('managedBy').isEmpty() and self.dot('managedBy').includes(caller)), Action.add: lambda self=None, caller=None, value=None: value == caller, Action.remove: lambda value= None, caller= None, self= None: value == caller or self.dot('owner') == caller or (not self.dot('managedBy').isEmpty() and self.dot('managedBy').includes(caller))}, 'attendants': {Action.read: Constraint.fullAccess, Action.add: lambda caller=None, self=None, value=None: self.dot('owner') == None or (self.dot('owner') == caller or (not self.dot('managedBy').isEmpty() and self.dot('managedBy').includes(caller))), Action.remove: lambda value= None, self= None, caller= None: (value != self.dot('owner') and (self.dot('managedBy').isEmpty() or not self.dot('managedBy').includes(value))) and (self.dot('owner') == caller or (not self.dot('managedBy').isEmpty() and self.dot('managedBy').includes(caller)) or value == caller)}, 'managedBy': {Action.read: Constraint.fullAccess, Action.add: lambda self= None, caller= None, value= None: self.dot('owner') == None or (self.dot('owner') == caller and ((not self.dot('attendants').isEmpty() and self.dot('attendants').includes(value)) or value == caller)), Action.remove: lambda value= None, self= None, caller= None: value != self.dot('owner') and self.dot('owner') == caller}, 'title': {Action.update: lambda caller=None, self=None, value=None: self.dot('owner') == None or self.dot('owner') == caller or (not self.dot('managedBy').isEmpty() and self.dot('managedBy').includes(caller))}, 'description': {Action.update: lambda caller=None, self=None, value=None: self.dot('owner') == None or self.dot('owner') == caller or (not self.dot('managedBy').isEmpty() and self.dot('managedBy').includes(caller))}, 'owner': {Action.update: lambda self= None, value= None, caller= None: self.dot('owner') == None and value == caller}, 'categories': {Action.add: lambda caller=None, self=None, value=None: self.dot('owner') == caller or (not self.dot('managedBy').isEmpty() and self.dot('managedBy').includes(caller)), Action.remove: lambda self= None, caller= None, value= None: self.dot('owner') == caller or (not self.dot('managedBy').isEmpty() and self.dot('managedBy').includes(caller)) or (not value.dot('moderators').isEmpty() and value.dot('moderators').includes(caller))}, 'logs': {Action.add: lambda self=None, caller=None, value=None: value.dot('user') == caller}}, 'Category': {'subscribers': {Action.add: lambda self=None, caller=None, value=None: value == caller, Action.remove: lambda self=None, caller=None, value=None: value == caller}, 'events': {Action.add: lambda self=None, caller=None, value=None: value.dot('owner') == caller or (not value.dot('managedBy').isEmpty() and value.dot('managedBy').includes(caller)) or value.dot('owner') == None, Action.remove: lambda self=None, caller=None, value=None: value.dot('owner') == caller or (not value.dot('managedBy').isEmpty() and value.dot('managedBy').includes(caller))}}, 'Ad': {}, 'Log': {'user': {Action.read: lambda self= None, caller= None: self.dot('user') == caller, Action.update: lambda self=None, caller=None, value=None: value == caller}, 'timestamp': {Action.read: lambda self= None, caller= None: self.dot('user') == caller}, 'event': {Action.read: lambda self= None, caller= None: self.dot('user') == caller}}}, Role.PREMIUMUSER: {'Person': {}, 'Event': {'Event': {Action.create: Constraint.fullAccess}}, 'Category': {}, 'Ad': {}, 'Log': {}}, Role.MODERATOR: {'Person': {'email': {Action.read: lambda self= None, caller= None: not self.dot('subscriptions').isEmpty() and not caller.dot('moderates').isEmpty() and self.dot('subscriptions').exists((lambda s: s.dot('moderators').includes(caller)))}, 'moderates': {Action.remove: lambda caller=None, self=None, value=None: self == caller}}, 'Event': {'categories': {Action.remove: lambda self= None, caller= None, value= None: self.dot('owner') == caller or (not self.dot('managedBy').isEmpty() and self.dot('managedBy').includes(caller)) or (not value.dot('moderators').isEmpty() and value.dot('moderators').includes(caller))}}, 'Category': {'subscribers': {Action.read: lambda self= None, caller= None: self.dot('moderators').includes(caller)}, 'events': {Action.remove: lambda value= None, caller= None, self= None: value.dot('owner') == caller or (not value.dot('managedBy').isEmpty() and value.dot('managedBy').includes(caller)) or (not self.dot('moderators').isEmpty() and self.dot('moderators').includes(caller))}, 'moderators': {Action.remove: lambda self=None, caller=None, value=None: value == caller}}, 'Ad': {}, 'Log': {}}, Role.ADMIN: {'Person': {'logs': {Action.read: Constraint.fullAccess}, 'role': {Action.update: Constraint.fullAccess}, 'moderates': {Action.add: lambda self=None, caller=None, value=None: self.dot('role') == dtm.Role.MODERATOR, Action.remove: lambda self=None, caller=None, value=None: self.dot('role') == dtm.Role.MODERATOR}}, 'Event': {'logs': {Action.read: Constraint.fullAccess}}, 'Category': {'Category': {Action.create: Constraint.fullAccess, Action.delete: Constraint.fullAccess}, 'moderators': {Action.read: Constraint.fullAccess, Action.add: lambda self=None, caller=None, value=None: value.dot('role') == dtm.Role.MODERATOR, Action.remove: lambda self=None, caller=None, value=None: value.dot('role') == dtm.Role.MODERATOR}, 'subscribers': {Action.read: Constraint.fullAccess}, 'events': {Action.read: Constraint.fullAccess}, 'name': {Action.read: Constraint.fullAccess, Action.update: Constraint.fullAccess}}, 'Ad': {'Ad': {Action.create: Constraint.fullAccess, Action.delete: Constraint.fullAccess}, 'content': {Action.read: Constraint.fullAccess, Action.update: Constraint.fullAccess}}, 'Log': {'user': {Action.read: Constraint.fullAccess}, 'timestamp': {Action.read: Constraint.fullAccess}, 'event': {Action.read: Constraint.fullAccess}}}}
    
EventPlatformNAGSecurityModel.validate()